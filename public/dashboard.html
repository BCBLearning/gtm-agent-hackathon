<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GTM-Agent Dashboard</title>
<style>
body { font-family: Arial, sans-serif; max-width: 1000px; margin:0 auto; padding:20px;}
h1 { color:#333; }
button { padding:15px 30px; font-size:16px; background:#007bff; color:white; border:none; border-radius:5px; cursor:pointer; margin:10px 5px;}
button:hover { background:#0056b3; }
.lead { border:1px solid #ddd; padding:15px; margin:15px 0; border-radius:5px; background:#f9f9f9;}
.success { color:#28a745;}
.error { color:#dc3545;}
</style>
</head>
<body>
<h1>üöÄ GTM-Agent Dashboard</h1>
<p>Mode: <strong id="mode">...</strong></p>
<button onclick="runAgent()">‚ñ∂Ô∏è Execute GTM Agent</button>
<button onclick="viewJSON()">üìä View Raw API Response</button>
<h2>Results:</h2>
<div id="results"></div>

<script>
async function runAgent() {
    const resultsDiv = document.getElementById('results');
    resultsDiv.innerHTML = '<p>üîÑ Executing GTM Agent...</p>';
    try {
        const response = await fetch('/api/run');
        const data = await response.json();
        document.getElementById('mode').textContent = data.mode;

        let html = `<p class="success"><strong>GTM Agent executed successfully!</strong></p>`;
        html += `<p><em>Executed at: ${new Date(data.execution_summary.execution_time).toLocaleString()}</em></p>`;

        html += `<div style="background:#e8f5e9;padding:15px;border-radius:5px;margin:15px 0;">
                    <h3>üìà Business Impact Summary</h3>
                    <p><strong>Potential Pipeline:</strong> ${data.business_impact.potential_pipeline}</p>
                    <p><strong>Time Saved:</strong> ${data.business_impact.time_saved}</p>
                    <p><strong>ROI:</strong> ${data.business_impact.roi}</p>
                 </div>`;

        if (data.data.leads && data.data.leads.length > 0) {
            data.data.leads.forEach((lead, index) => {
                const email = data.data.emails[index];
                html += `<div class="lead">
                            <h3>üè¢ ${lead.company}</h3>
                            <p><strong>Contact:</strong> ${lead.name} (${lead.title})</p>
                            <p><strong>Email:</strong> ${lead.email}</p>
                            <p><strong>Phone:</strong> ${lead.phone}</p>
                            <p><strong>Status:</strong> ${lead.status}</p>
                            <div style="background:#fff3cd; padding:10px; margin-top:10px; border-radius:3px;">
                                <strong>Generated Email:</strong><br>
                                <small>To: ${email.to}</small><br>
                                <small>Subject: ${email.subject}</small>
                            </div>
                         </div>`;
            });
        } else {
            html += '<p>No leads detected this time.</p>';
        }

        resultsDiv.innerHTML = html;

    } catch (error) {
        resultsDiv.innerHTML = `<p class="error">‚ùå Error: ${error.message}</p>`;
    }
}

async function viewJSON() {
    const response = await fetch('/api/run');
    const data = await response.json();
    document.getElementById('results').innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
}

window.onload = function() { setTimeout(runAgent, 1000); }
</script>
</body>
</html>